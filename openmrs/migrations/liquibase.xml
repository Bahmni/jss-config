<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <!--
        See http://www.liquibase.org/manual/home#available_database_refactorings
        for a list of supported elements and attributes
    -->

    <changeSet id="JSS-1" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_10__Registration.sql"/>
    </changeSet>
    <changeSet id="JSS-2" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_11__Registration.sql"/>
    </changeSet>
    <changeSet id="JSS-3" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_12__Registration.sql"/>
    </changeSet>
    <changeSet id="JSS-4" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_13__Registration.sql"/>
    </changeSet>
    <changeSet id="JSS-5" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_14__Registration.sql"/>
    </changeSet>
    <changeSet id="JSS-6" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_15__Registration.sql"/>
    </changeSet>
    <changeSet id="JSS-7" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_16__Registration.sql"/>
    </changeSet>
    <changeSet id="JSS-8" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_17__JSSAddressHierarchy.sql"/>
    </changeSet>
    <changeSet id="JSS-9" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_19__RegistrationRole.sql"/>
    </changeSet>
    <changeSet id="JSS-10" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_21__Registration.sql"/>
    </changeSet>
    <changeSet id="JSS-12" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_26__CreateAtomFeedEventsForPatients.sql"/>
    </changeSet>
    <changeSet id="JSS-13" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_27__SetAtomFeedChunking.sql"/>
    </changeSet>
    <changeSet id="JSS-14" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_28__RegistrationAttributesNameAndDescriptionFix.sql"/>
    </changeSet>
    <changeSet id="JSS-15" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_32__MakeClassAttributeAConcept.sql"/>
    </changeSet>
    <changeSet id="JSS-16" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_33__MakeEducationDetailsAttributeAConcept.sql"/>
    </changeSet>
    <changeSet id="JSS-17" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_34__MakeOccupationAttributeAConcept.sql"/>
    </changeSet>
    <changeSet id="JSS-18" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_35__RegistrationAttributesNameAndDescriptionFix.sql"/>
    </changeSet>
    <changeSet id="JSS-19" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_36__AddAgricultureConcept.sql"/>
    </changeSet>
    <changeSet id="JSS-20" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_38__SetValueAsConceptForPersonAttributes.sql"/>
    </changeSet>
    <changeSet id="JSS-22" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_46__AddSecondaryIdentifierToPersonAttributeType.sql"/>
    </changeSet>
    <changeSet id="JSS-23" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_47__RegistrationPersonAttributeSortOrderUpdate.sql"/>
    </changeSet>
    <changeSet id="JSS-24" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_48__RegistrationPersonAttributeTypeUpdateDescriptionForStaticFields.sql"/>
    </changeSet>
    <changeSet id="JSS-25" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_49__UndoRegistrationAttributeDescriptionForStaticFields.sql"/>
    </changeSet>
    <changeSet id="JSS-26" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_10__SetupVisitTypes.sql"/>
    </changeSet>
    <changeSet id="JSS-27" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_20__CreateVisitTypeForRevisit.sql"/>
    </changeSet>
    <changeSet id="JSS-28" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_63__AddEmergencyVisitType.sql"/>
    </changeSet>
    <changeSet id="JSS-29" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_65__ConceptSetForVitals.sql"/>
    </changeSet>
    <changeSet id="JSS-31" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_74__AddGramPanchayatAndHouseNumberStreetAsNewAddressHierarchyLevels.sql"/>
    </changeSet>
    <changeSet id="JSS-32" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_75__MarkVilageAsMandatoryField.sql"/>
    </changeSet>
    <changeSet id="JSS-33" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_76__RemoveHealthCenter.sql"/>
    </changeSet>
    <changeSet id="bahmni-atomfeed-offset-marker" author="tw" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM scheduler_task_config where schedulable_class = 'org.openmrs.module.atomfeed.scheduler.tasks.EventRecordsNumberOffsetMarkerTask'
            </sqlCheck>
        </preConditions>
        <comment>rel3</comment>
        <sql>
            INSERT INTO  scheduler_task_config  (name, description, schedulable_class, 
                   start_time, start_time_pattern, repeat_interval, start_on_startup, started, 
                   created_by, date_created, changed_by, date_changed, last_execution_time, uuid ) 
            VALUES ('OpenMRS event offset marker task', NULL, 'org.openmrs.module.atomfeed.scheduler.tasks.EventRecordsNumberOffsetMarkerTask',
                   '2014-01-14 00:00:00','MM/dd/yyyy HH:mm:ss',86400, 1, 1, 
                   1, now(), NULL, NULL, NULL, uuid());
        </sql>
    </changeSet>

    <changeSet id="JSS-34" author="tw" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM global_property where property = 'emr.personImagesDirectory'
            </sqlCheck>
        </preConditions>
        <comment>Set up person image directory</comment>
        <sql>
            insert into global_property (`property`, `property_value`, `description`, `uuid`)
            values ('emr.personImagesDirectory',
            '/home/jss/patient_images',
            'Location of patient images - required by emrapi',
            uuid()
            );
        </sql>
    </changeSet>
    <changeSet id="JSS-35" author="tw" context="rel3">
        <comment>Enable registration app for registration clerk</comment>
        <sql>
            INSERT INTO role_privilege(role, privilege) VALUES('RegistrationClerk', 'app:registration') ON DUPLICATE KEY UPDATE privilege = 'app:registration';
        </sql>
    </changeSet>
    <changeSet id="JSS-37" author="tw" context="rel3">
        <comment>Enable emergency app for registration clerk</comment>
        <sql>
            INSERT INTO role_privilege(role, privilege) VALUES('RegistrationClerk', 'app:emergency') ON DUPLICATE KEY UPDATE privilege = 'app:emergency';
        </sql>
    </changeSet>
    <changeSet id="JSS-38" author="tw" context="rel3">
        <comment>Rename visit types</comment>
        <sql>
            UPDATE visit_type set name = 'OPD - NEW' where name = 'REG';
            UPDATE visit_type set name = 'OPD - RETURNING' where name = 'REVISIT';
        </sql>
    </changeSet>
    <changeSet id="JSS-39" author="tw" context="rel3">
        <comment>Setup person_name as preferred for all patients</comment>
        <sql>
            UPDATE person_name SET preferred = 1 WHERE person_id IN (SELECT patient_id FROM patient);
        </sql>
    </changeSet>
    <changeSet id="JSS-40" author="tw" context="rel3">
        <comment>Add role for document upload</comment>
        <sql>
            INSERT INTO role (role, description) VALUES ('bahmni-document-uploader', 'bahmni-document-uploader');
        </sql>
    </changeSet>
    <changeSet id="JSS-41" author="tw" context="rel3">
        <comment>Add privileges for document upload</comment>
        <sql>
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'add observations');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'Edit Encounters');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'Edit Visits');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Concepts');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Encounters');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Global Properties');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Identifier Types');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Location Attribute Types');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Locations');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Observations');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Patient Identifiers');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Patients');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View People');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Person Attribute Types');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Providers');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Users');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Visit Attribute Types');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Visit Types');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'View Visits');
        </sql>
    </changeSet>
    <changeSet id="JSS-42" author="tw" context="rel3">
        <comment>Enable document upload app for bahmni-document-uploader</comment>
        <sql>
            INSERT INTO role_privilege(role, privilege) VALUES('bahmni-document-uploader', 'app:document-upload') ON DUPLICATE KEY UPDATE privilege = 'app:document-upload';
        </sql>
    </changeSet>
    <changeSet id="JSS-43" author="tw" context="rel3">
        <comment>Global property to auto close visits next day</comment>
        <sql>
            INSERT INTO global_property (`property`, `property_value`, `description`, `uuid`)
            VALUES ('visits.autoCloseMinimumNumberOfDays', '1', 'Minimum number of days after which visit should be auto closed', uuid())
            ON DUPLICATE KEY UPDATE property_value = '1';
        </sql>
    </changeSet>
    <changeSet id="JSS-44" author="tw" context="rel3">
        <comment>Remove unused global property visits.autoCloseMinimumNumberOfDays</comment>
        <delete tableName="global_property">
            <where>property = 'visits.autoCloseMinimumNumberOfDays'</where>
        </delete>
    </changeSet>
    <changeSet id="JSS-45" author="tw" context="rel3">
        <comment>Delete AutoCloseVisitsTask from scheduler_task_config</comment>
        <delete tableName="scheduler_task_config">
            <where>schedulable_class = 'org.openmrs.scheduler.tasks.AutoCloseVisitsTask'</where>
        </delete>
    </changeSet>
    <changeSet id="JSS-46" author="tw" context="rel3">
        <comment>Add CloseStaleVisitsTask</comment>
        <insert tableName="scheduler_task_config">
            <column name="name" value="Close Stale Visits Task" />
            <column name="description" value="Auto close visit task after number of hours specified by emrapi.visitExpireHours" />
            <column name="schedulable_class" value="org.openmrs.module.emrapi.adt.CloseStaleVisitsTask" />
            <column name="start_on_startup" valueBoolean="true" />
            <column name="start_time_pattern" value="MM/dd/yyyy HH:mm:ss" />
            <column name="start_time" valueDate="2011-11-28T23:59:59" />
            <column name="repeat_interval" value="86400" />
            <column name="date_created" valueDate="CURRENT_TIMESTAMP" />
            <column name="created_by" value="1" />
            <column name="uuid" value="e087ff42-9792-11e3-b248-425861b86ab6" />
        </insert>
    </changeSet>
    <changeSet id="JSS-47" author="tw" context="rel3">
        <comment>Add global property to configure visit expire hours</comment>
        <sql>
            INSERT INTO global_property (`property`, `property_value`, `description`, `uuid`)
            VALUES ('emrapi.visitExpireHours', '24', 'Number of hours after which visit can be auto closed', uuid())
            ON DUPLICATE KEY UPDATE property_value = '24';
        </sql>
    </changeSet>
    <changeSet id="JSS-48" author="tw" context="rel3">
        <comment>Clear visits.autoCloseVisitType</comment>
        <sql>
            UPDATE global_property set property_value = '' where property = 'visits.autoCloseVisitType';
        </sql>
    </changeSet>
    <changeSet id="JSS-49" author="tw" context="rel3">
        <comment>Add Role - EmergencyRegistration</comment>
        <sql>
            -- Role required to use the emergency application
            insert into role (role, description) values ('EmergencyRegistration', 'EmergencyRegistration');
            -- Privileges for EmergencyRegistration
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Add Observations');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Add Patient Identifiers');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Add Patients');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Add People');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Add Visits');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Edit Encounters');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Edit Patient Identifiers');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Edit Patients');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Edit People');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Edit Visits');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Manage Address Hierarchy');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Administration Functions');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Concepts');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Encounter Types');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Encounters');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Global Properties');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Identifier Types');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Location Attribute Types');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Locations');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Navigation Menu');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Observations');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Patient Identifiers');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Patients');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View People');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Person Attribute Types');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Providers');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Users');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Visit Attribute Types');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Visit Types');
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'View Visits');
            insert into role_privilege (role, privilege) values('EmergencyRegistration', 'app:emergency') ON DUPLICATE KEY UPDATE privilege = 'app:emergency';
        </sql>
    </changeSet>
    <changeSet id="JSS-50" author="tw" context="rel3">
        <comment>Remove emergency privilege for Registration Clerk</comment>
        <sql>
            delete from role_privilege where role = 'RegistrationClerk' and privilege = 'app:emergency';
        </sql>
    </changeSet>

    <changeSet id="JSS-201402181517" author="Neha,Banka" context="rel3">
        <comment>Create new visit type for IPD</comment>
        <insert tableName="visit_type">
            <column name="name" value="IPD" />
            <column name="description" value="Visit for patients being admitted" />
            <column name="creator" value="1" />
            <column name="uuid" valueComputed="uuid()" />
            <column name="date_created" valueDate="CURRENT_TIMESTAMP" />
        </insert>
    </changeSet>
    <changeSet id="JSS-201402181524" author="Neha,Banka" context="rel3">
        <comment>Create new visit type for Sub-center</comment>
        <insert tableName="visit_type">
            <column name="name" value="SUB-CENTRE" />
            <column name="description" value="Visit for patients that have been referred to the Village Centre in Ganiyari from the sub-centres" />
            <column name="creator" value="1" />
            <column name="uuid" valueComputed="uuid()" />
            <column name="date_created" valueDate="CURRENT_TIMESTAMP" />
        </insert>
    </changeSet>
    <changeSet id="JSS-201402181532" author="Neha,Banka" context="rel3">
        <comment>Create new visit type for Chronic diseases</comment>
        <insert tableName="visit_type">
            <column name="name" value="CHRONIC" />
            <column name="description" value="Visit for patients with chronic illnesses such as Tuberculosis, Cancer, Diabetes, Leprosy, HIV, RHD, etc. and come for a repeat check-up" />
            <column name="creator" value="1" />
            <column name="uuid" valueComputed="uuid()" />
            <column name="date_created" valueDate="CURRENT_TIMESTAMP" />
        </insert>
    </changeSet>
    <changeSet id="JSS-201402181533" author="Neha,Banka" context="rel3">
        <comment>Create new visit type ANC for pregnant women</comment>
        <insert tableName="visit_type">
            <column name="name" value="ANC" />
            <column name="description" value="Visit for pregnant women who come for regular check-ups during pregnancy" />
            <column name="creator" value="1" />
            <column name="uuid" valueComputed="uuid()" />
            <column name="date_created" valueDate="CURRENT_TIMESTAMP" />
        </insert>
    </changeSet>

    <changeSet id="JSS-201402181545" author="Neha,Banka" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'Sub-center Clerk'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="Sub-center Clerk"/>
            <column name="description" value="Privilege for Subcenter clerk"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="JSS-201402181632" author="Neha,Banka" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from role where role = 'jss-subcenter-clerk'</sqlCheck>
        </preConditions>
        <comment>Add role for Village Subcenter clerk</comment>
        <insert tableName="role">
            <column name="role" value="jss-subcenter-clerk"/>
            <column name="description" value="JSS Subcenter Clerk role"/>
        </insert>
    </changeSet>
    <changeSet id="JSS-201402181634" author="Neha,Banka" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from role_privilege where role = 'jss-subcenter-clerk' and privilege = 'Sub-center Clerk'</sqlCheck>
        </preConditions>
        <comment>Add role_privileges for subcenter clerk</comment>
        <insert tableName="role_privilege">
            <column name="role" value="jss-subcenter-clerk"/>
            <column name="privilege" value="Sub-center Clerk"/>
        </insert>
    </changeSet>
    <changeSet id="JSS-201402201102" author="tw" context="rel3">
        <comment>Add missing role_privilege - EmergencyRegistration</comment>
        <sql>
            insert into role_privilege (role, privilege) values ('EmergencyRegistration', 'Manage Encounter Roles');
        </sql>
    </changeSet>
    <changeSet id="JSS-201402201344" author="tw" context="rel3">
        <comment>Remove sub center specific role, privileges, visit type</comment>
        <sql>
            DELETE FROM role_privilege WHERE role = 'jss-subcenter-clerk';
            DELETE FROM role WHERE role = 'jss-subcenter-clerk';
            DELETE FROM privilege WHERE privilege = 'Sub-center Clerk';
            DELETE FROM visit_type WHERE name = 'SUB-CENTRE';
        </sql>
    </changeSet>
    <changeSet id="JSS-201402201750" author="tw" context="rel3">
        <comment>Add missing privileges for document upload</comment>
        <sql>
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'Manage Encounter Roles');
            INSERT INTO role_privilege (role, privilege) VALUES ('bahmni-document-uploader', 'Add Encounters');
        </sql>
    </changeSet>
    <changeSet id="JSS-201404091506" author="sushmitharaos, arathyjan" context="rel4">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) FROM concept_name where name = 'Patient File' and locale_preferred = 1;
            </sqlCheck>
        </preConditions>
        <comment>Add concept set patient document and patient file concept as member</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Patient Document', 'Patient Document', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'PATIENT', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'DOCUMENT', 1);
            set @patient_document_concept_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Patient file', 'Patient file', 'N/A', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'PATIENT,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'FILE', 1);
            set @patient_file_concept_id = @concept_id;
            call add_concept_set_members(@patient_document_concept_id,@patient_file_concept_id,1);
        </sql>
    </changeSet>
    <changeSet id="JSS-201404101655" author="Gurpreet" context="rel4">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM role_privilege where role = 'RegistrationClerk' and privilege = 'Manage Encounter Roles';
            </sqlCheck>
        </preConditions>
        <comment>Add missing role_privilege - which was originally added into bahmni-core as changeset bahmni-40 </comment>
        <sql>
            insert into role_privilege (role, privilege) values ('RegistrationClerk', 'Manage Encounter Roles');
        </sql>
    </changeSet>    
    <changeSet id="JSS-201404161343" author="d3, arathyjan" context="rel4">
        <comment>Add concept set patient document and patient file concept as member</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Discharge Summary', 'Discharge Summary', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Discharge', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Summary', 1);
            set @discharge_summary_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Hospital Course', 'Hospital Course', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Hospital,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Course', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,0);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'History and Examination Notes', 'History and Examination Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'History,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Examination', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, ' Surgeries and Procedures', ' Surgeries and Procedures', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Surgeries,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Procedures', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,2);
            set @surgeries_and_procedure_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Date of Operation', 'Date of Operation', 'Date', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Date,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Operation', 1);
            call add_concept_set_members(@surgeries_and_procedure_id,@concept_id,0);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Operative Procedure', 'Operative Procedure', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Operative,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Procedure', 1);
            call add_concept_set_members(@surgeries_and_procedure_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Follow up Date', 'Follow up Date', 'Date', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Follow up', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Follow', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Date', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,3);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Lab Investigation Notes', 'Lab Investigation Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Lab', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Investigation', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,4);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Radiology Notes', 'Radiology Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Radiology', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,5);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Other Notes', 'Other Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Other', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,6);
        </sql>
    </changeSet>
    <changeSet id="JSS-201404161559" author="deepak,arathyjan" context="rel4">
        <insert tableName="privilege">
            <column name="privilege" value="Discharge Summary"/>
            <column name="description" value="Discharge Summary Privilege"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="JSS-201404281640" author="Mujir, arathyjan" context="rel4">
        <comment>Add members of Vital Concept</comment>
        <sql>
                set @concept_id = 0;
                set @concept_name_short_id = 0;
                set @concept_name_full_id = 0;
    
                select concept_id INTO @vitals_concept_id from concept_name where name='VITALS_CONCEPT' and locale_preferred = 1;
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Pulse Data', 'Pulse Data', 'N/A', 'Concept Details', true);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Pulse', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
                call add_concept_set_members(@vitals_concept_id, @concept_id,0);
                set @pulse_data_id = @concept_id;
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Pulse', 'Pulse', 'Numeric', 'Misc', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Pulse', 1);
                call add_concept_set_members(@pulse_data_id, @concept_id, 0);
                call add_concept_numeric(@concept_id, 72, 72, '/min');

                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Pulse Abnormal', 'Pulse Abnormal', 'Boolean', 'Abnormal', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Pulse', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Abnormal', 1);
                call add_concept_set_members(@pulse_data_id, @concept_id, 0);
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Blood Pressure', 'Blood Pressure', 'N/A', 'ConvSet', true);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Blood', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Pressure', 1);
                call add_concept_set_members(@vitals_concept_id, @concept_id,0);
                set @blood_pressure_concept_id = @concept_id;
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Systolic Data', 'Systolic Data', 'N/A', 'Concept Details', true);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Systolic', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
                call add_concept_set_members(@blood_pressure_concept_id, @concept_id,0);
                set @systolic_data_concept_id = @concept_id;
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Systolic', 'Systolic', 'Numeric', 'Misc', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Systolic', 1);
                call add_concept_set_members(@systolic_data_concept_id, @concept_id, 0);
                call add_concept_numeric(@concept_id, 110, 140, 'mm Hg');
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Systolic Abnormal', 'Systolic Abnormal', 'Boolean', 'Abnormal', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Systolic', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Abnormal', 1);
                call add_concept_set_members(@systolic_data_concept_id, @concept_id, 0);
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Diastolic Data', 'Diastolic Data', 'N/A', 'Concept Details', true);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Diastolic', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
                call add_concept_set_members(@blood_pressure_concept_id, @concept_id,0);
                set @diastolic_data_concept_id = @concept_id;
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Diastolic', 'Diastolic', 'Numeric', 'Misc', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Diastolic', 1);
                call add_concept_set_members(@diastolic_data_concept_id, @concept_id, 0);
                call add_concept_numeric(@concept_id, 70, 85, 'mm Hg');
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Diastolic Abnormal', 'Diastolic Abnormal', 'Boolean', 'Abnormal', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Diastolic', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Abnormal', 1);
                call add_concept_set_members(@diastolic_data_concept_id, @concept_id, 0);
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Temperature Data', 'Temperature Data', 'N/A', 'Concept Details', true);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Temperature', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
                call add_concept_set_members(@vitals_concept_id, @concept_id,0);
                set @temp_data_id = @concept_id;
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Temperature', 'Temperature', 'Numeric', 'Misc', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Temperature', 1);
                call add_concept_set_members(@temp_data_id, @concept_id, 0);
                call add_concept_numeric(@concept_id, 98.6, 98.6, 'F');

                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Temperature Abnormal', 'Temperature Abnormal', 'Boolean', 'Abnormal', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Temperature', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Abnormal', 1);
                call add_concept_set_members(@temp_data_id, @concept_id, 0);
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'RR Data', 'RR Data', 'N/A', 'Concept Details', true);
                call add_concept_word(@concept_id, @concept_name_short_id, 'RR', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
                call add_concept_set_members(@vitals_concept_id, @concept_id,0);
                set @rr_data_id = @concept_id;
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'RR', 'RR', 'Numeric', 'Misc', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'RR', 1);
                call add_concept_set_members(@rr_data_id, @concept_id, 0);
                call add_concept_numeric(@concept_id, 16, 20, '/min');

                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'RR Abnormal', 'Temperature Abnormal', 'Boolean', 'Abnormal', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'RR', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Abnormal', 1);
                call add_concept_set_members(@rr_data_id, @concept_id, 0);
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'SPO2 Data', 'SPO2 Data', 'N/A', 'Concept Details', true);
                call add_concept_word(@concept_id, @concept_name_short_id, 'SPO2', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
                call add_concept_set_members(@vitals_concept_id, @concept_id,0);
                set @spo2_data_id = @concept_id;
    
                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'SPO2', 'SPO2', 'Numeric', 'Misc', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'SPO2', 1);
                call add_concept_set_members(@spo2_data_id, @concept_id, 0);
                call add_concept_numeric(@concept_id, 97, null, '%');

                call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'SPO2 Abnormal', 'Temperature Abnormal', 'Boolean', 'Abnormal', false);
                call add_concept_word(@concept_id, @concept_name_short_id, 'SPO2', 1);
                call add_concept_word(@concept_id, @concept_name_short_id, 'Abnormal', 1);
                call add_concept_set_members(@spo2_data_id, @concept_id, 0);
    
            </sql>
    </changeSet>
    <changeSet id="JSS-201404301052" author="mujir,arathyjan" context="rel4">
        <comment>Rename vitals_concept to vitals</comment>
        <sql> update concept_name set name = 'Vitals' where name = 'VITALS_CONCEPT';</sql>
    </changeSet>
    <changeSet id="JSS-201404301139" author="mujir,arathyjan" context="rel4">
        <comment>delete discharge summary</comment>
        <sql>
            call delete_concept('Hospital course');
            call delete_concept('History and Examination Notes');
            call delete_concept('Operative Procedure');
            call delete_concept('Date of operation');
            call delete_concept('Surgeries and Procedures');
            call delete_concept('Follow up date');
            call delete_concept('Lab investigation notes');
            call delete_concept('Radiology notes');
            call delete_concept('Other Notes');
            call delete_concept('Discharge Summary');
        </sql>
    </changeSet>
    <changeSet id="JSS-201404301143" author="mujir,arathyjan" context="rel4">
        <comment>add concept_set discharge summary</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Discharge Summary', 'Discharge Summary', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Discharge', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Summary', 1);
            set @discharge_summary_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Hospital Course Data', 'Hospital Course Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Hospital', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Course', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,0);
            set @hospital_course_data_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Hospital Course', 'Hospital Course', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Hospital,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Course', 1);
            call add_concept_set_members(@hospital_course_data_id,@concept_id,0);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'History and Examination Notes Data', 'History and Examination Notes Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'History', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Examination', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,0);
            set @history_examination_data_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'History and Examination Notes', 'History and Examination Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'History,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Examination', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@history_examination_data_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Surgeries and Procedures', 'Surgeries and Procedures', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Surgeries,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Procedures', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,2);
            set @surgeries_and_procedure_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Date of Operation Data', 'Date of Operation Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Date', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Operation', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            call add_concept_set_members(@surgeries_and_procedure_id,@concept_id,0);
            set @date_operation_data_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Date of Operation', 'Date of Operation', 'Date', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Date,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Operation', 1);
            call add_concept_set_members(@date_operation_data_id,@concept_id,0);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Operative Procedure Data', 'Operative Procedure Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Operative', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Procedure', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            call add_concept_set_members(@surgeries_and_procedure_id,@concept_id,0);
            set @operative_procedure_data_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Operative Procedure', 'Operative Procedure', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Operative,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Procedure', 1);
            call add_concept_set_members(@operative_procedure_data_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Follow up Date Data', 'Follow up Date Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Follow up', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Date', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,0);
            set @follow_up_date_data_id = @concept_id;            

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Follow up Date', 'Follow up Date', 'Date', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Follow up', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Follow', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Date', 1);
            call add_concept_set_members(@follow_up_date_data_id,@concept_id,3);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Lab Investigation Notes Data', 'Lab Investigation Notes Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Lab', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Investigation', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,0);
            set @lab_investigation_notes_data_id = @concept_id; 

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Lab Investigation Notes', 'Lab Investigation Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Lab', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Investigation', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@lab_investigation_notes_data_id,@concept_id,4);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Radiology Notes Data', 'Radiology Notes Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Radiology', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,0);
            set @radiology_notes_data_id = @concept_id; 

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Radiology Notes', 'Radiology Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Radiology', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@radiology_notes_data_id,@concept_id,5);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Other Notes Data', 'Other Notes Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Other', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,0);
            set @Other_notes_data_id = @concept_id; 

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Other Notes', 'Other Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Other', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@Other_notes_data_id,@concept_id,6);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405041504" author="mujir" context="rel4">
        <comment>add chief complaint concept set</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'History', 'History', 'N/A', 'Misc', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'History', 1);
            set @history_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Chief Complaint Data', 'Chief Complaint Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Chief', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Complaint', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            set @chief_complaint_data_id = @concept_id;
            call add_concept_set_members(@history_id, @concept_id, 0);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Chief Complaint', 'Chief Complaint', 'Coded', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Chief,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Complaint', 1);
            call add_concept_set_members(@chief_complaint_data_id, @concept_id, 0);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Chief Complaint Duration', 'Chief Complaint Duration', 'Numeric', 'Duration', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Chief,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Complaint', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Duration', 1);
            call add_concept_set_members(@chief_complaint_data_id, @concept_id, 0);
            call add_concept_numeric(@concept_id, null, null, null);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405051646" author="neha, mujir" context="rel4">
        <comment>add chief complaint concept set</comment>
        <sql>
            select concept_id INTO @history_concept_id from concept_name where name='History' and locale_preferred = 1;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Chief Complaint Notes Data', 'Chief Complaint Notes Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Chief', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Complaint', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            set @notes_data_id = @concept_id;
            call add_concept_set_members(@history_concept_id, @concept_id, 0);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Chief Complaint Notes', 'Chief Complaint Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Chief', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Complaint', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes,', 1);
            call add_concept_set_members(@notes_data_id, @concept_id, 0);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405061225" author="vinay" context="rel4">
        <comment>Get rid of OPD-New and OPD-Returning. </comment>
        <sql>
            update visit_type set retired = true, retired_by = 1, date_retired = current_date() where name in ('OPD - NEW', 'OPD - RETURNING', 'CHRONIC', 'ANC');
        </sql>
    </changeSet>
    <changeSet id="JSS-201405061358" author="vinay" context="rel4">
        <comment>Get rid of Transfer Patient disposition</comment>
        <sql>
            call delete_concept('Transfer Patient');
        </sql>
    </changeSet>
    <changeSet id="JSS-201405071251" author="mujir" context="rel4">
        <comment>add non-coded chief complaint concept set</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            select concept_id INTO @history_id from concept_name where name='History' and locale_preferred = 1;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Non-Coded Chief Complaint Data', 'Non-Coded Chief Complaint Data', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Non-Coded', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Coded', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Chief', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Complaint', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Data', 1);
            set @non_coded_chief_complaint_data_id = @concept_id;
            call add_concept_set_members(@history_id, @concept_id, 0);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Non-Coded Chief Complaint', 'Non-Coded Chief Complaint', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Non-Coded', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Coded', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Chief,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Complaint', 1);
            call add_concept_set_members(@non_coded_chief_complaint_data_id, @concept_id, 0);

            select concept_id INTO @chief_complaint_duration_id from concept_name where name='Chief Complaint Duration' and locale_preferred = 1;
            call add_concept_set_members(@non_coded_chief_complaint_data_id, @chief_complaint_duration_id, 0);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405071129" author="vinay" context="rel4">
        <comment>Add OPD visit type</comment>
        <insert tableName="visit_type">
            <column name="name" value="OPD" />
            <column name="description" value="OPD visit" />
            <column name="creator" value="1" />
            <column name="uuid" valueComputed="uuid()" />
            <column name="date_created" valueDate="CURRENT_TIMESTAMP" />
        </insert>
    </changeSet>
    <changeSet id="JSS-201405081500" author="mujir" context="rel4">
        <comment>fixing concept set data. removing use of data nodes (concepts of class concept details) where its not required.</comment>
        <sql>
            call delete_concept('Chief Complaint Notes Data');
            select concept_id INTO @history_id from concept_name where name='History' and locale_preferred = 1;
            select concept_id INTO @chief_complaint_notes_id from concept_name where name='Chief Complaint Notes' and locale_preferred = 1;
            call add_concept_set_members(@history_id, @chief_complaint_notes_id, 0);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405081718" author="mujir" context="rel4">
        <comment>fixing discharge summary concept set. removing use of data nodes (concepts of class concept details) where its not required.</comment>
        <sql>
            call delete_concept('Other Notes');
            call delete_concept('Other Notes Data');
            call delete_concept('Radiology Notes');
            call delete_concept('Radiology Notes Data');
            call delete_concept('Lab Investigation Notes');
            call delete_concept('Lab Investigation Notes Data');
            call delete_concept('Follow up Date');
            call delete_concept('Follow up Date Data');
            call delete_concept('Operative Procedure');
            call delete_concept('Operative Procedure Data');
            call delete_concept('Date of Operation');
            call delete_concept('Date of Operation Data');
            call delete_concept('Surgeries and Procedures');
            call delete_concept('History and Examination Notes');
            call delete_concept('History and Examination Notes Data');
            call delete_concept('Hospital Course');
            call delete_concept('Hospital Course Data');
            call delete_concept('Discharge Summary');

            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Discharge Summary', 'Discharge Summary', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Discharge', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Summary', 1);
            set @discharge_summary_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Hospital Course', 'Hospital Course', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Hospital,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Course', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,0);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'History and Examination Notes', 'History and Examination Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'History,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Examination', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, ' Surgeries and Procedures', ' Surgeries and Procedures', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Surgeries,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Procedures', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,2);
            set @surgeries_and_procedure_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Date of Operation', 'Date of Operation', 'Date', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Date,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Operation', 1);
            call add_concept_set_members(@surgeries_and_procedure_id,@concept_id,0);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Operative Procedure', 'Operative Procedure', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Operative,', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Procedure', 1);
            call add_concept_set_members(@surgeries_and_procedure_id,@concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Follow up Date', 'Follow up Date', 'Date', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Follow up', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Follow', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Date', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,3);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Lab Investigation Notes', 'Lab Investigation Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Lab', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Investigation', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,4);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Radiology Notes', 'Radiology Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Radiology', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,5);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Other Notes', 'Other Notes', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Other', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Notes', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,6);

        </sql>
    </changeSet>

    <changeSet id="JSS-201405121430" author="rohan">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="2">
                SELECT COUNT(*) FROM concept_name where name in ('Chief Complaint Notes');
            </sqlCheck>
        </preConditions>
        <comment>Change sort weight for Chief Complaint Notes Data.</comment>
        <sql>
            update concept_set set sort_weight=2 where concept_id=(select concept_id from concept_name where name='Chief Complaint Notes' limit 1);
        </sql>
    </changeSet>

    <changeSet id="JSS-201405121432" author="rohan">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="2">
                SELECT COUNT(*) FROM concept_name where name in ('Non-Coded Chief Complaint Data');
            </sqlCheck>
        </preConditions>
        <comment>Change sort weight for Non-Coded Chief Complaint Data.</comment>
        <sql>
            update concept_set set sort_weight=1 where concept_id=(select concept_id from concept_name where name='Chief Complaint Notes Data' limit 1);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405131200" author="rohan">
        <comment>Change Interval time for Scheduler Tasks.</comment>
        <sql>
            update scheduler_task_config set repeat_interval=30 where name='OpenElis Patient Atom Feed Task';
            update scheduler_task_config set repeat_interval=300 where name='OpenElis Patient  Atom Feed Failed Event Task';
            update scheduler_task_config set repeat_interval=30 where name='OpenERP Feed Task';
            update scheduler_task_config set repeat_interval=300 where name='OpenERP Failed Feed Task';
            update scheduler_task_config set repeat_interval=900 where name='Reference Data Task';
            update scheduler_task_config set repeat_interval=300 where name='Reference Data Failed Event Task';
        </sql>
    </changeSet>
    <changeSet id="JSS-201405141259" author="mihir/shruthi">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM concept_name where name in ('Diagnosis Set of Sets')
            </sqlCheck>
        </preConditions>
        <comment>Add diagnosis set of sets concept</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Diagnosis Set of Sets', 'Diagnosis Set of Sets', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Diagnosis', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Set of Sets', 1);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405141113" author="mihir/shruthi">
        <validCheckSum>3:fdb31c1d95d7168afa2359f24afc1682</validCheckSum>
        <validCheckSum>3:0e435346d02030b84e72e1b04748231c</validCheckSum>
        <comment>set emr.concept.diagnosisSetOfSets global property</comment>
        <sql>
            set @concept_uuid = 0;
            select distinct c.uuid from concept c inner join concept_name cn on c.concept_id = cn.concept_id where name in ('Diagnosis Set of Sets') into @concept_uuid;

            select uuid() into @concept_uuid;
            INSERT INTO global_property (`property`, `property_value`, `description`, `uuid`)
            VALUES ('emr.concept.diagnosisSetOfSets', @concept_uuid, 'Diagnosis Set of Sets', @concept_uuid)
            ON DUPLICATE KEY UPDATE property_value = @concept_uuid;
        </sql>
    </changeSet>
    <changeSet id="JSS-201405161734" author="Neha" context="rel4">
        <comment>Rename visit types</comment>
        <sql>
            UPDATE visit_type set name = 'LAB VISIT' where name = 'LAB_VISIT';
            UPDATE visit_type set name = 'PHARMACY VISIT' where name = 'PHARMACY_VISIT';
        </sql>
    </changeSet>
    <changeSet id="JSS-201405161500" author="Hemanth" context="rel4">
        <comment>Migrate High normal value for SPO2</comment>
        <sql>
            update concept_numeric set hi_normal=100 where concept_id = (select concept_id from concept_name where name = 'SPO2' and locale_preferred = 1);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405161501" author="Hemanth" context="rel4">
        <comment>Migrate High normal value for Pulse</comment>
        <sql>
            update concept_numeric set hi_normal=80 where concept_id = (select concept_id from concept_name where name = 'Pulse' and locale_preferred = 1);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405161750" author="d3" context="rel4">
        <comment>Update locale.allowed.list to en</comment>
        <sql>
            update global_property set property_value='en' where property='locale.allowed.list';
        </sql>
    </changeSet>
    <changeSet id="JSS-201405180557" author="Hemanth" context="rel4">
        <comment>Create BMI Status concept</comment>
        <sql>
            set @concept_id = 0;
            set @answer_concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @concept_source_id = 0;
            set @concept_map_type_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'BMI STATUS', 'BMI STATUS', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'BMI', 1);
            call add_concept_word(@concept_id, @concept_name_full_id, 'STATUS', 1);
            call add_concept_set_members((select concept_id from concept_name where name = 'REGISTRATION_CONCEPTS'),@concept_id, 1);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405190709" author="Mihir" context="rel4">
        <comment>Changing sort weights of Diastolic Data and Systolic Data</comment>
        <sql>
            update concept_set set sort_weight=1 where concept_id=(select distinct concept_id from concept_name where name="Diastolic Data" limit 1);
            update concept_set set sort_weight=0 where concept_id=(select distinct concept_id from concept_name where name="Systolic Data" limit 1);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405160946" author="vinay" context="rel4">
        <comment>#2298. Rename History concept set and Chief complaint notes</comment>
        <sql>
            set @concept_id = 0;
            delete from concept_set where concept_set_id in (
            select concept_id from (
            select cs.concept_set_id as concept_id from concept_set cs
            inner join concept_name cn1 on cs.concept_set = cn1.concept_id and cn1.concept_name_type = 'FULLY_SPECIFIED' and cn1.name = 'History'
            inner join concept_name cn2 on cs.concept_id = cn2.concept_id and cn2.concept_name_type = 'FULLY_SPECIFIED' and cn2.name = 'Chief Complaint Notes') wrapped_select);

            select uuid() into @concept_id;
            insert into concept_set(concept_id, concept_set, sort_weight, creator, date_created, uuid) (
            select cn2.concept_id, cn1.concept_id, 3, 1, curdate(), @concept_id from concept_name cn1 inner join concept_name cn2
            where cn1.concept_name_type = 'FULLY_SPECIFIED' and cn1.name = 'History'
            and cn2.concept_name_type = 'FULLY_SPECIFIED' and cn2.name = 'History And Examination Notes');
        </sql>
    </changeSet>
    <changeSet id="JSS-201405161719" author="vinay" context="rel4">
        <comment>#2298. Rename History to History and Examination Notes</comment>
        <sql>
            update concept_name set name = 'History and Examination' where name = 'History';
            INSERT INTO concept_word (word, locale, weight, concept_id, concept_name_id)  
            (select UPPER('Examination'), 'en', 1, concept_id, concept_name_id from concept_name where name = 'History and Examincation' and concept_name_type = 'FULLY_SPECIFIED');
        </sql>
    </changeSet>
    <changeSet id="JSS-201405190617" author="d3" context="rel4">
        <comment>Set start on startup for sync jobs</comment>
        <sql>
            UPDATE scheduler_task_config SET start_on_startup = 1 
            WHERE schedulable_class IN ('org.bahmni.module.elisatomfeedclient.api.task.OpenElisPatientFeedTask', 
            'org.bahmni.module.elisatomfeedclient.api.task.OpenElisPatientFeedFailedEventsTask',
            'org.bahmni.module.openerpatomfeedclient.api.task.OpenERPSaleOrderFeedTask',
            'org.bahmni.module.openerpatomfeedclient.api.task.OpenERPSaleOrderFailedFeedTask',
            'org.bahmni.module.referencedatafeedclient.task.ReferenceDataFeedTask',
            'org.bahmni.module.referencedatafeedclient.task.ReferenceDataFailedEventTask');
        </sql>
    </changeSet>
    <changeSet id="JSS-201405161725" author="vinay" context="rel4">
        <comment>#2298. Rename History to History and Examination Notes</comment>
        <sql>
            UPDATE visit
            SET visit_type_id = (SELECT visit_type_id
                                 FROM visit_type
                                 WHERE name IN ('OPD'))
            WHERE visit_type_id IN (SELECT visit_type_id
                                     FROM visit_type
                                     WHERE name IN ('OPD - NEW', 'OPD - RETURNING')); 
        </sql>
    </changeSet>
    <changeSet id="JSS-201405161738" author="vinay" context="rel4">
        <comment>Add new roles</comment>
        <insert tableName="role">
            <column name="role" value="Doctor" />
            <column name="description" value="Role for the JSS doctor" />
            <column name="uuid" valueComputed="uuid()" />
        </insert>
        <insert tableName="role">
            <column name="role" value="Nurse" />
            <column name="description" value="Role for the JSS nurse" />
            <column name="uuid" valueComputed="uuid()" />
        </insert>
        <insert tableName="role">
            <column name="role" value="PatientRecordManager" />
            <column name="description" value="Role for people other than Doctor and Nurse" />
            <column name="uuid" valueComputed="uuid()" />
        </insert>
    </changeSet>
    <changeSet id="JSS-201405211623" author="vinay" context="rel4">
        <insert tableName="privilege">
            <column name="privilege" value="app:clinical:history"/>
            <column name="description" value="JSS observation history view and edit"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="JSS-201405211713" author="vinay" context="rel4">
        <insert tableName="privilege">
            <column name="privilege" value="app:clinical:diagnosisTab"/>
            <column name="description" value="View and Edit Diagnosis tab"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="app:clinical:dispositionTab"/>
            <column name="description" value="View Disposition tab"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="app:clinical:observationTab"/>
            <column name="description" value="View Disposition tab"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="app:clinical:consultationTab"/>
            <column name="description" value="View Disposition tab"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="JSS-201405211625" author="vinay" context="rel4">
        <comment>Add roles</comment>
        <sqlFile path="V1_77__AddPrivileges.sql"/>
    </changeSet>
    <changeSet id="JSS-201405221032" author="Mujir, Neha" context="rel4">
        <comment>Add Second Vitals Concept</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Second Vitals', 'Second Vitals', 'N/A', 'Misc', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'VITALS', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'CONCEPT', 1);
            set @second_vitals_concept_id = @concept_id;

            select concept_id INTO @concept_id from concept_name where name='Pulse Data' and locale_preferred = 1;
            call add_concept_set_members(@second_vitals_concept_id, @concept_id,0);

            select concept_id INTO @concept_id from concept_name where name='Blood Pressure' and locale_preferred = 1;
            call add_concept_set_members(@second_vitals_concept_id, @concept_id,0);

            select concept_id INTO @concept_id from concept_name where name='Temperature Data' and locale_preferred = 1;
            call add_concept_set_members(@second_vitals_concept_id, @concept_id,0);

            select concept_id INTO @concept_id from concept_name where name='RR Data' and locale_preferred = 1;
            call add_concept_set_members(@second_vitals_concept_id, @concept_id,0);

            select concept_id INTO @concept_id from concept_name where name='SPO2 Data' and locale_preferred = 1;
            call add_concept_set_members(@second_vitals_concept_id, @concept_id,0);
        </sql>
    </changeSet>
    <changeSet id="JSS-201405221039" author="d3" context="rel4">
        <comment>Set bahmni.cacheHeadersFilter.expiresDuration to 4 hrs</comment>
        <sql>
            UPDATE global_property set property_value = '240' where property = 'bahmni.cacheHeadersFilter.expiresDuration';
        </sql>
    </changeSet>
    <changeSet id="JSS-201405241244" author="d3" context="rel4">
        <comment>Remove unwanted privileges for Doctors and Nurses</comment>
        <sql>
            DELETE from role_privilege where role = 'Doctor' and privilege = 'app:registration';
            DELETE from role_privilege where role = 'Doctor' and privilege = 'app:emergency';
            DELETE from role_privilege where role = 'Doctor' and privilege = 'app:document-upload';
            DELETE from role_privilege where role = 'Doctor' and privilege = 'app:radiologyOrders';
            DELETE from role_privilege where role = 'Doctor' and privilege = 'app:adt';
            DELETE from role_privilege where role = 'Nurse' and privilege = 'app:registration';
            DELETE from role_privilege where role = 'Nurse' and privilege = 'app:emergency';
            DELETE from role_privilege where role = 'Nurse' and privilege = 'app:document-upload';
            DELETE from role_privilege where role = 'Nurse' and privilege = 'app:radiologyOrders';
        </sql>
    </changeSet>
    <changeSet id="JSS-201406061056" author="d3" context="rel4">
        <comment>Add Additional advice on discharge concept</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            select concept_id INTO @discharge_summary_id from concept_name where name='Discharge Summary' and locale_preferred = 1;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Additional Advice on Discharge', 'Additional Advice on Discharge', 'Text', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Additional', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Advice', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Discharge', 1);
            call add_concept_set_members(@discharge_summary_id,@concept_id,7);
        </sql>
    </changeSet>
    <changeSet id="JSS-201406061530" author="indraneel" context="rel4">
        <comment>Remove non-coded chief complaint data from History and Examination concept set.</comment>
        <sql>
            delete from concept_set where concept_set in (select concept_id from concept_name where name='History and examination')
            and concept_id in (select concept_id from concept_name where name = 'Non-Coded Chief Complaint Data');
        </sql>
    </changeSet>
    <changeSet id="JSS-201406061545" author="indraneel" context="rel4">
        <comment>Add non coded chief complaint concept to chief complaint data concept set</comment>
        <sql>
            set @non_coded_concept_id = 0;
            set @chief_complaint_data_concept_id = 0;

            select concept_id INTO @non_coded_concept_id from concept_name where name='Non-Coded Chief Complaint' and locale_preferred = 1;
            select concept_id INTO @chief_complaint_data_concept_id from concept_name where name='Chief Complaint Data' and locale_preferred = 1;

            call add_concept_set_members(@chief_complaint_data_concept_id,@non_coded_concept_id,2);
        </sql>
    </changeSet>
    <changeSet id="JSS-201406251410" author="indraneel">
        <comment>sql to search patients seen by the given provider today</comment>
        <sql>
            insert into global_property	(property,property_value,description,uuid) values ('emrapi.sqlSearch.todaysPatientsByProvider','select distinct concat(pn.given_name," ", pn.family_name) as name, pi.identifier as identifier, concat("",p.uuid) as uuid,
            concat("",v.uuid) as activeVisitUuid
            from
            visit v join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 and v.voided=0
            join patient_identifier pi on v.patient_id = pi.patient_id and pi.voided=0
            join person p on p.person_id = v.patient_id  and p.voided=0
            join encounter en on en.visit_id = v.visit_id and en.voided=0
            join encounter_provider ep on ep.encounter_id = en.encounter_id  and ep.voided=0
            join provider pr on ep.provider_id=pr.provider_id and pr.retired=0
            join person per on pr.person_id=per.person_id and per.voided=0
            where
            date(en.encounter_datetime)=curdate() and
            pr.uuid=${provider_uuid}
            order by en.encounter_datetime desc','Sql query to get list of active patients by provider uuid',uuid());
        </sql>
    </changeSet>
    <changeSet id="JSS-201406261644" author="arathy/mujir">
        <comment>fixing migration id 'JSS-201405141113'</comment>
        <sql>
            set @concept_uuid = 0;
            select distinct c.uuid from concept c inner join concept_name cn on c.concept_id = cn.concept_id where name in ('Diagnosis Set of Sets') into @concept_uuid;

            INSERT INTO global_property (`property`, `property_value`, `description`, `uuid`)
            VALUES ('emr.concept.diagnosisSetOfSets', @concept_uuid, 'Diagnosis Set of Sets', uuid())
            ON DUPLICATE KEY UPDATE property_value = @concept_uuid;
        </sql>
    </changeSet>
    <changeSet id="JSS-201406271749" author="shruthi/mujir">
        <comment>moving chief complaint answers to a new concept 'Chief Complaint Answers'. Clinical can now preload answers for a concept.</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @chief_complaint_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Chief Complaint Answers', 'Chief Complaint Answers', 'Coded', 'Misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Chief Complaint Answers', 1);
            set @chief_complaint_answers_id = @concept_id;

            select concept_id from concept_name where name ='Chief Complaint' and concept_name_type='SHORT' into @chief_complaint_id;
            update concept_answer set concept_id=@chief_complaint_answers_id where concept_id=@chief_complaint_id;
        </sql>
    </changeSet>
    <changeSet id="JSS-201407021648" author="sushmitharaos,arathyjan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) FROM concept_name where name = 'Fee Information' and locale_preferred = 1;
            </sqlCheck>
        </preConditions>
        <comment>Add concept set Fee Information</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Fee Information', 'Fee Information', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'FEE', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'INFORMATION', 1);
            set @patient_document_concept_id = @concept_id;
        </sql>
    </changeSet>
    <changeSet id="JSS-201407021650" author="sushmitharaos,arathyjan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from concept_set where concept_set = (SELECT concept_id FROM concept_name where name = 'Fee Information' and locale_preferred = 1);
            </sqlCheck>
        </preConditions>
        <comment>Add registration fee and comment ad group members to fee information concept</comment>
        <sql>
            set @fee_information_concept_set_id = 0;
            SELECT concept_id into @fee_information_concept_set_id FROM concept_name where name = 'Fee Information' and locale_preferred = 1;
            SELECT concept_id into @comment_concept_id FROM concept_name where name = 'COMMENTS' and locale_preferred = 1;
            SELECT concept_id into @registration_concept_id FROM concept_name where name = 'REGISTRATION FEES' and locale_preferred = 1;
            call add_concept_set_members(@fee_information_concept_set_id,@registration_concept_id,1);
            call add_concept_set_members(@fee_information_concept_set_id,@comment_concept_id,1);
        </sql>
    </changeSet>
    <changeSet id="JSS-201407031248" author="sushmitharaos,arathyjan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="4">
                SELECT count(*) from concept_set where concept_set = (SELECT concept_id FROM concept_name where name = 'REGISTRATION_CONCEPTS' and locale_preferred = 1);
            </sqlCheck>
        </preConditions>
        <comment>Add registration fee and comment ad group members to fee information concept</comment>
        <sql>
            set @registration_concept_id = 0;
            set @registration_fee_concept_id = 0;
            set @comment_concept_id = 0;
            
            SELECT concept_id into @registration_concept_id FROM concept_name where name = 'REGISTRATION_CONCEPTS' and locale_preferred = 1;
            SELECT concept_id into @comment_concept_id FROM concept_name where name = 'COMMENTS' and locale_preferred = 1;
            SELECT concept_id into @registration_fee_concept_id FROM concept_name where name = 'REGISTRATION FEES' and locale_preferred = 1;
            
            delete from concept_set where concept_id = @registration_fee_concept_id and concept_set = @registration_concept_id;
            delete from concept_set where concept_id = @comment_concept_id and concept_set = @registration_concept_id;
        </sql>
    </changeSet>
    <changeSet id="JSS-201407141248" author="vinay">
        <comment>Add caresettings to all roles</comment>
        <sql>
            insert into role_privilege (role, privilege) values ('Doctor', 'Get Care Settings');
            insert into role_privilege (role, privilege) values ('Nurse', 'Get Care Settings');
        </sql>
    </changeSet>
    <changeSet id="JSS-201408121130" author="Indraneel">
        <comment>Adding templates to all observation templates</comment>
        <sql>
            select concept_id from concept_name where name = 'All Observation Templates' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            set @set_concept_id = @concept_id;

            select concept_id from concept_name where name = 'History and Examination' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            select concept_id from concept_name where name = 'Consultation Images' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,2);

            select concept_id from concept_name where name = 'Investigations' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,3);

            select concept_id from concept_name where name = 'Vitals' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,4);

            select concept_id from concept_name where name = 'Second Vitals' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,5);

            select concept_id from concept_name where name = 'OB/GYN' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,6);

            select concept_id from concept_name where name = 'Obstetrics' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,7);

            select concept_id from concept_name where name = 'Gynaecology' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,8);

            select concept_id from concept_name where name = 'Discharge Summary' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,9);
        </sql>
    </changeSet>
    <changeSet id="JSS-201408141700" author="Indraneel">
        <comment>Correcting the concept set members in all observation templates</comment>
        <sql>
            select concept_id from concept_name where name = 'All Observation Templates' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            set @set_concept_id = @concept_id;

            delete from concept_set where concept_set=@set_concept_id;

            select concept_id from concept_name where name = 'History and Examination' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,1);

            select concept_id from concept_name where name = 'Consultation Image' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,2);

            select concept_id from concept_name where name = 'Vitals' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,4);

            select concept_id from concept_name where name = 'Second Vitals' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,5);

            select concept_id from concept_name where name = 'OBS/GYN' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,6);

            select concept_id from concept_name where name = 'Obstetrics' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,7);

            select concept_id from concept_name where name = 'Gynaecology' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,8);

            select concept_id from concept_name where name = 'Discharge Summary' and concept_name_type = 'FULLY_SPECIFIED' into @concept_id;
            call add_concept_set_members (@set_concept_id,@concept_id,9);
        </sql>
    </changeSet>
    <changeSet id="JSS-201408180936" author="Mujir">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM global_property where property = 'uploaded.files.directory'
            </sqlCheck>
        </preConditions>
        <comment>Add directory for imported files</comment>
        <sql>
            update global_property set property_value='/home/jss/uploaded-files/mrs/' where property='uploaded.files.directory';
        </sql>
    </changeSet>

    <changeSet id="JSS-201408201152" author="Banka">
        <comment>Change datatype of TSH</comment>
        <sql>
            update concept join concept_name on concept_name.concept_id = concept.concept_id set datatype_id=(select concept_datatype_id from concept_datatype where name = 'Text') where concept_name.name = 'TSH';
        </sql>
    </changeSet>

    <changeSet id="JSS-201408201208" author="Banka">
        <comment>Migrate Numeric value to Text for TSH</comment>
        <sql>
            update obs set value_text = value_numeric, value_numeric = null where value_numeric is not null and concept_id = (select concept_id from concept_name where name = 'TSH')
        </sql>
    </changeSet>

    <changeSet id="JSS-201409151643" author="Rohan, Hemanth">
        <comment>Migrate Duration Units as Days for previous Drug Orders</comment>
        <sql>
            update drug_order set duration_units=(select concept_id from concept_name where name='Days' and concept_name_type='FULLY_SPECIFIED') where dosing_type='org.openmrs.FreeTextDosingInstructions';
        </sql>
    </changeSet>

    <changeSet id="JSS-201409151650" author="Rohan, Hemanth">
        <comment>Calculate Duration for previous Drug Orders from date_activated and auto_expire_date and migrate the same</comment>
        <sql>
            update drug_order d set d.duration = (select datediff(o.auto_expire_date, o.date_activated) from orders o where o.order_id = d.order_id) where d.dosing_type='org.openmrs.FreeTextDosingInstructions';
        </sql>
    </changeSet>

    <changeSet id="JSS-201409151748" author="Rohan, Hemanth">
        <comment>Migrate Dosing Instructions to JSON for previous Drug Orders</comment>
        <sql>
            update drug_order set dosing_instructions=CONCAT(CONCAT(CONCAT('{"dose":"',SUBSTRING_INDEX(dosing_instructions,' ',1)), CONCAT('", "doseUnits":"',SUBSTRING_INDEX(dosing_instructions,' ',-1))), '"}') where dosing_type='org.openmrs.FreeTextDosingInstructions';
        </sql>
    </changeSet>

    <changeSet id="JSS-201409151749" author="Rohan, Hemanth">
        <comment>Migrate Dosing Instructions Type to Flexible for previous Drug Orders</comment>
        <sql>
            update drug_order set dosing_type='org.openmrs.module.bahmniemrapi.drugorder.dosinginstructions.FlexibleDosingInstructions' where dosing_type='org.openmrs.FreeTextDosingInstructions';
        </sql>
    </changeSet>
    <changeSet id="JSS-201410311249" author="Chethan, Vinay">
        <comment>Days as implemented in JSS-201409151643 was changed to Day(s). This is to fix based on new concept</comment>
        <sql>
            update drug_order set duration_units=(select concept_id from concept_name where name='Day(s)' and concept_name_type='FULLY_SPECIFIED') where dosing_type='org.openmrs.module.bahmniemrapi.drugorder.dosinginstructions.FlexibleDosingInstructions' and duration_units is null;
        </sql>
    </changeSet>
    <changeSet id="JSS-201411051207" author="Rohan">
        <comment>Change all Lab Test concept classes from Test to LabTest</comment>
        <sql>
            update concept set class_id=(select concept_class_id from concept_class where name='LabTest') where class_id=1 and concept_id in (select concept_id from concept_set where concept_set=(select concept_id from concept_name where name='All_Tests_and_Panels' and concept_name_type='FULLY_SPECIFIED'));
        </sql>
    </changeSet>
    <changeSet id="JSS-201411051212" author="Rohan">
        <comment>Change all Radiology concept classes from Test to Radiology</comment>
        <sql>
            update concept set class_id=(select concept_class_id from concept_class where name='Radiology') where class_id=1 and concept_id in (select concept_id from concept_set where concept_set=(select concept_id from concept_name where name='Radiology' and concept_name_type='FULLY_SPECIFIED'));
        </sql>
    </changeSet>
    <changeSet id="JSS-201502021505" author="Chethan, Sravanthi">
        <comment>Remove the comments for BMI and BMI STATUS</comment>
        <sql>
            update obs set comments=NULL where concept_id=(select concept_id from concept_name where name='BMI' and concept_name_type='FULLY_SPECIFIED');
            update obs set comments=NULL where concept_id=(select concept_id from concept_name where name='BMI Status' and concept_name_type='FULLY_SPECIFIED');
        </sql>
    </changeSet>
    <changeSet id="JSS-201525021230" author="Swathi, Soumya">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from concept_name where name = 'Transfer Patient'  and concept_name_type='FULLY_SPECIFIED'</sqlCheck>
        </preConditions>
        <comment>Adding Transfer Patient disposition</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @concept_source_id = 0;
            set @concept_map_type_id = 0;
            set @disposition_concept_id = 0;

            SELECT concept_source_id INTO @concept_source_id FROM concept_reference_source where name = 'org.openmrs.module.emrapi';
            SELECT concept_id INTO @disposition_concept_id FROM concept_name where name = 'Disposition' and concept_name_type='FULLY_SPECIFIED';
            SELECT concept_map_type_id INTO @concept_map_type_id FROM concept_map_type where name = 'SAME-AS';


            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Transfer Patient', 'Transfer Patient', 'N/A', 'misc', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Transfer', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'Patient', 1);
            call add_concept_reference_map (@concept_id, @concept_source_id, 'TRANSFER',@concept_map_type_id);
            set @child1_concept_id = @concept_id;

            call add_concept_answer(@disposition_concept_id, @child1_concept_id, 3);
        </sql>
    </changeSet>
    <changeSet id="JSS-201505051636" author="Charles">
        <comment>Create BMI Abnormal concept</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'BMI ABNORMAL', 'BMI ABNORMAL', 'Boolean', 'Abnormal', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'BMI', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'ABNORMAL', 1);
        </sql>
    </changeSet>

    <changeSet id="JSS-201505051640" author="Charles">
        <comment>Create BMI Data concept</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'BMI Data', 'BMI', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'BMI', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'DATA', 1);

            call add_concept_set_members(@concept_id, (select concept_id from concept_name where name = 'BMI' and concept_name_type = 'FULLY_SPECIFIED'), 1);
            call add_concept_set_members(@concept_id, (select concept_id from concept_name where name = 'BMI ABNORMAL' and concept_name_type = 'FULLY_SPECIFIED'), 2);
        </sql>
    </changeSet>

    <changeSet id="JSS-201505061650" author="Banka, Charles">
        <comment>Create BMI Status Abnormal concept</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'BMI STATUS ABNORMAL', 'BMI STATUS ABNORMAL', 'Boolean', 'Abnormal', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'BMI', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'STATUS', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'ABNORMAL', 1);
        </sql>
    </changeSet>
    <changeSet id="JSS-201505061705" author="Banka, Charles">
        <comment>Create BMI Status Data concept</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'BMI Status Data', 'BMI Status', 'N/A', 'Concept Details', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'BMI', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'STATUS', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'DATA', 1);

            call add_concept_set_members(@concept_id, (select concept_id from concept_name where name = 'BMI STATUS' and concept_name_type = 'FULLY_SPECIFIED'), 1);
            call add_concept_set_members(@concept_id, (select concept_id from concept_name where name = 'BMI STATUS ABNORMAL' and concept_name_type = 'FULLY_SPECIFIED'), 2);
        </sql>
    </changeSet>
    <changeSet id="JSS-201505081050" author="Charles, Banka" runOnChange="true">
        <comment>Migrating BMI and BMI Status Obs to be grouped under BMI Data and BMI Status Data</comment>
        <sqlFile path="V1_78_AddBMIObsToParentObsGroupForOldPatients.sql" splitStatements="true" endDelimiter=";;"/>
    </changeSet>
    <changeSet id="JSS-201506031347" author="Hemanth" runOnChange="true">
        <comment>sql to search patients seen by the given provider today</comment>
        <sql>
            DELETE FROM global_property WHERE property = 'emrapi.sqlSearch.todaysPatientsByProvider';
            insert into global_property	(property,property_value,description,uuid) values ('emrapi.sqlSearch.todaysPatientsByProvider','select distinct concat(pn.given_name," ", pn.family_name) as name, pi.identifier as identifier, concat("",p.uuid) as uuid,
            concat("",v.uuid) as activeVisitUuid,
            IF(va.value_reference = "Admitted", "true", "false") as hasBeenAdmitted
            from
            visit v join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 and v.voided=0
            join patient_identifier pi on v.patient_id = pi.patient_id and pi.voided=0
            join person p on p.person_id = v.patient_id  and p.voided=0
            join encounter en on en.visit_id = v.visit_id and en.voided=0
            join encounter_provider ep on ep.encounter_id = en.encounter_id  and ep.voided=0
            join provider pr on ep.provider_id=pr.provider_id and pr.retired=0
            join person per on pr.person_id=per.person_id and per.voided=0
            left outer join visit_attribute va on va.visit_id = v.visit_id and va.attribute_type_id = (
                select visit_attribute_type_id from visit_attribute_type where name="Admission Status"
            )
            where
            date(en.encounter_datetime)=curdate() and
            pr.uuid=${provider_uuid}
            order by en.encounter_datetime desc','Sql query to get list of active patients by provider uuid',uuid());
        </sql>
    </changeSet>

    <changeSet id="JSS-201507071330" author="Vikash, Chethan" runOnChange="true">
        <comment>sql to search patients seen by the given provider today</comment>
        <sql>
            DELETE FROM global_property WHERE property = 'emrapi.sqlSearch.todaysPatientsByProvider';
            insert into global_property	(property,property_value,description,uuid) values ('emrapi.sqlSearch.todaysPatientsByProvider','select distinct concat(pn.given_name," ", pn.family_name) as name, pi.identifier as identifier, concat("",p.uuid) as uuid,
            concat("",v.uuid) as activeVisitUuid,
            IF(va.value_reference = "Admitted", "true", "false") as hasBeenAdmitted
            from
            visit v join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 and v.voided=0
            join patient_identifier pi on v.patient_id = pi.patient_id and pi.voided=0
            join person p on p.person_id = v.patient_id  and p.voided=0
            join encounter en on en.visit_id = v.visit_id and en.voided=0
            join encounter_provider ep on ep.encounter_id = en.encounter_id  and ep.voided=0
            join provider pr on ep.provider_id=pr.provider_id and pr.retired=0
            join person per on pr.person_id=per.person_id and per.voided=0
            left outer join visit_attribute va on va.visit_id = v.visit_id and va.voided = 0 and va.attribute_type_id = (
            select visit_attribute_type_id from visit_attribute_type where name="Admission Status"
            )
            where
            date(en.encounter_datetime)=curdate() and
            pr.uuid=${provider_uuid}
            order by en.encounter_datetime desc','Sql query to get list of active patients by provider uuid',uuid());
        </sql>
    </changeSet>

    <changeSet id="JSS-201508211040" author="JP, Charles">
        <comment>Add Blood Group concept with answers</comment>
        <sql>
            set @concept_id = 0;
            set @answer_concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Blood Group Result', 'Blood Group', 'Coded', 'Misc', false);

            call add_concept(@answer_concept_id, @concept_name_short_id, @concept_name_full_id, 'A+', 'A+', 'Text', 'Misc', false);
            call add_concept_answer(@concept_id, @answer_concept_id, 1);

            call add_concept(@answer_concept_id, @concept_name_short_id, @concept_name_full_id, 'A-', 'A-', 'Text', 'Misc', false);
            call add_concept_answer(@concept_id, @answer_concept_id, 2);

            call add_concept(@answer_concept_id, @concept_name_short_id, @concept_name_full_id, 'B+', 'B+', 'Text', 'Misc', false);
            call add_concept_answer(@concept_id, @answer_concept_id, 3);

            call add_concept(@answer_concept_id, @concept_name_short_id, @concept_name_full_id, 'B-', 'B-', 'Text', 'Misc', false);
            call add_concept_answer(@concept_id, @answer_concept_id, 4);

            call add_concept(@answer_concept_id, @concept_name_short_id, @concept_name_full_id, 'AB+', 'AB+', 'Text', 'Misc', false);
            call add_concept_answer(@concept_id, @answer_concept_id, 5);

            call add_concept(@answer_concept_id, @concept_name_short_id, @concept_name_full_id, 'AB-', 'AB-', 'Text', 'Misc', false);
            call add_concept_answer(@concept_id, @answer_concept_id, 6);

            call add_concept(@answer_concept_id, @concept_name_short_id, @concept_name_full_id, 'O+', 'O+', 'Text', 'Misc', false);
            call add_concept_answer(@concept_id, @answer_concept_id, 7);

            call add_concept(@answer_concept_id, @concept_name_short_id, @concept_name_full_id, 'O-', 'O-', 'Text', 'Misc', false);
            call add_concept_answer(@concept_id, @answer_concept_id, 8);
        </sql>
    </changeSet>

    <changeSet id="JSS-201508211030" author="JP, Charles">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM person_attribute_type where name = 'bloodGroup';
            </sqlCheck>
        </preConditions>
        <comment>Adding Blood Group person attribute type</comment>
        <sql>
            set @concept_id = 0;

            SELECT concept_id INTO @concept_id FROM concept_name where name = 'Blood Group Result' and concept_name_type='FULLY_SPECIFIED';

            INSERT INTO person_attribute_type (name, description, format, searchable, creator, date_created, retired, sort_weight, uuid, foreign_key) VALUES ('bloodGroup', 'Blood Group', 'org.openmrs.Concept', '1', 1, now(), 0, 3, uuid(), @concept_id);
        </sql>
    </changeSet>

    <changeSet id="JSS-201509232323" author="Swathi, Jaswanth" context="rel0.76">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM person_attribute_type where name = 'Telephone Number';
            </sqlCheck>
        </preConditions>
        <comment>Adding Telephone Number person attribute type</comment>
        <sql>
            INSERT INTO person_attribute_type (name, description, format, searchable, creator, date_created, retired, sort_weight, uuid) VALUES ('Telephone Number', 'Telephone Number', 'java.lang.String', '0', 1, now(), 0, 3, uuid());
        </sql>
    </changeSet>

    <changeSet id="JSS-201509232326" author="Swathi, Jaswanth" context="rel0.76">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM person_attribute_type where name = 'Unknown patient';
            </sqlCheck>
        </preConditions>
        <comment>Adding Unknown patient person attribute type</comment>
        <sql>
            INSERT INTO person_attribute_type (name, description, format, searchable, creator, date_created, retired, sort_weight, uuid) VALUES ('Unknown patient', 'Unknown Patient', 'java.lang.String', '0', 1, now(), 0, 3, uuid());
        </sql>
    </changeSet>
    <changeSet id="JSS-201604211812" author="Gautam, Angshuman">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(concept_id) from concept where uuid="5090AAAAAAAAAAAAAAAAAAAAAAAAAAAA";
            </sqlCheck>
        </preConditions>
        <comment>update Height concept uuid to standard CEIL concept uuid</comment>
        <sql>
            update concept set uuid="5090AAAAAAAAAAAAAAAAAAAAAAAAAAAA" where concept_id in (
            select concept_name.concept_id from concept_name where name="Height" and concept_name_type="FULLY_SPECIFIED"
            );
        </sql>
    </changeSet>
    <changeSet id="JSS-201604211813" author="Gautam, Angshuman">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(concept_id) from concept where uuid="5089AAAAAAAAAAAAAAAAAAAAAAAAAAAA";
            </sqlCheck>
        </preConditions>
        <comment>update Weight concept uuid to standard CEIL concept uuid</comment>
        <sql>
            update concept set uuid="5089AAAAAAAAAAAAAAAAAAAAAAAAAAAA" where concept_id in (
            select concept_name.concept_id from concept_name where name="Weight" and concept_name_type="FULLY_SPECIFIED"
            );
        </sql>
    </changeSet>
    <changeSet id="JSS-2016050201" author="Dayaan">
        <comment>Confirmed Diagnosis View for Coded and Non Coded Diagnosis</comment>
        <sql>
            CREATE OR REPLACE VIEW openmrs.confirmed_diagnosis_view_new AS
            SELECT `diagnosis_obs`.`person_id` AS `person_id`,
            CASE when `diagnosis_concept_name`.`name` = 'Coded Diagnosis' THEN `actual_diagnosis`.`name`
            when `diagnosis_concept_name`.`name` = 'Non-coded Diagnosis' THEN `diagnosis_obs`.`value_text`
            else ""
            end
            AS `name`,
            `actual_diagnosis`.`concept_id` AS `concept_id`,
            `diagnosis_obs`.`obs_datetime` AS `obs_datetime`,
            `diagnosis_obs`.`encounter_id` AS `encounter_id`,
            `e`.`encounter_datetime` AS `encounter_datetime`,
            `v`.`visit_id` AS `visit_id`,
            `v`.`date_started` AS `visit_date_started`,
            `v`.`date_stopped` AS `visit_date_stopped`

            FROM
            (`openmrs`.`obs` `diagnosis_obs` JOIN `openmrs`.`concept_name` `diagnosis_concept_name`
            ON ((
            (`diagnosis_obs`.`concept_id` = `diagnosis_concept_name`.`concept_id`)
            AND ((`diagnosis_concept_name`.`name` = 'Coded Diagnosis') OR
            (`diagnosis_concept_name`.`name` = 'Non-coded Diagnosis'))
            AND (`diagnosis_concept_name`.`voided` IS FALSE)
            AND (`diagnosis_concept_name`.`concept_name_type` = 'FULLY_SPECIFIED')
            ))
            JOIN `openmrs`.`obs` `certainty`
            ON ((
            (`certainty`.`obs_group_id` = `diagnosis_obs`.`obs_group_id`)
            AND (`certainty`.`voided` IS FALSE) AND
            (`certainty`.`concept_id` =
            (SELECT `cn`.`concept_id`
            FROM `openmrs`.`concept_name` `cn`
            WHERE ((`cn`.`name` = 'Diagnosis Certainty')
            AND (`cn`.`concept_name_type` = 'FULLY_SPECIFIED'))))
            AND (`certainty`.`value_coded` =
            (SELECT `cn`.`concept_id`
            FROM `openmrs`.`concept_name` `cn`
            WHERE ((`cn`.`name` = 'Confirmed') AND
            (`cn`.`concept_name_type` = 'FULLY_SPECIFIED')
            )
            )
            )
            ))
            LEFT JOIN `openmrs`.`obs` `ruled_out` ON (
            ((`ruled_out`.`obs_group_id` = `diagnosis_obs`.`obs_group_id`)
            AND (`ruled_out`.`voided` IS FALSE)
            AND (`ruled_out`.`concept_id` =
            (SELECT `cn`.`concept_id`
            FROM `openmrs`.`concept_name` `cn`
            WHERE
            ((`cn`.`name` = 'Ruled Out Diagnosis') AND
            (`cn`.`concept_name_type` = 'FULLY_SPECIFIED')
            )
            )
            )
            )
            )
            LEFT JOIN `openmrs`.`obs` `revised` ON
            (((`revised`.`obs_group_id` = `diagnosis_obs`.`obs_group_id`)
            AND (`revised`.`voided` IS FALSE)
            AND (`revised`.`concept_id` =
            (SELECT `cn`.`concept_id`
            FROM `openmrs`.`concept_name` `cn`
            WHERE ((`cn`.`name` = 'Bahmni Diagnosis Revised')
            AND (`cn`.`concept_name_type` = 'FULLY_SPECIFIED'))))
            AND
            (`revised`.`value_coded` =
            (SELECT `openmrs`.`global_property`.`property_value`
            FROM `openmrs`.`global_property`
            WHERE (`openmrs`.`global_property`.`property` = 'concept.true')
            )
            )
            ))


            left join `openmrs`.`concept_name` `actual_diagnosis`
            on((
            (`diagnosis_obs`.`value_coded` = `actual_diagnosis`.`concept_id`)
            and (`actual_diagnosis`.`voided` is false)
            and (`actual_diagnosis`.`concept_name_type` = 'FULLY_SPECIFIED')
            )

            )

            join `openmrs`.`encounter` `e` on
            ((`diagnosis_obs`.`encounter_id` = `e`.`encounter_id`))
            join `openmrs`.`visit` `v` on((`e`.`visit_id` = `v`.`visit_id`)))
            where (isnull(`revised`.`obs_id`) and isnull(`ruled_out`.`obs_id`) and
            (`diagnosis_obs`.`voided` is false));
        </sql>
    </changeSet>
</databaseChangeLog>